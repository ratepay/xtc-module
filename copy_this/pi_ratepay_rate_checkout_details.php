<?php//XTC STANDARD BEGINinclude ('includes/application_top.php');// create smarty elements$smarty = new Smarty;// include boxesrequire (DIR_FS_CATALOG . 'templates/' . CURRENT_TEMPLATE . '/source/boxes.php');// include needed functionsrequire_once (DIR_FS_INC . 'xtc_address_label.inc.php');require_once (DIR_FS_INC . 'xtc_get_address_format_id.inc.php');require_once (DIR_FS_INC . 'xtc_check_stock.inc.php');unset($_SESSION['tmp_oID']);// if the customer is not logged on, redirect them to the login pageif (!isset($_SESSION['customer_id'])) {    if (ACCOUNT_OPTIONS == 'guest') {        xtc_redirect(xtc_href_link(FILENAME_CREATE_GUEST_ACCOUNT, '', 'SSL'));    } else {        xtc_redirect(xtc_href_link(FILENAME_LOGIN, '', 'SSL'));    }}// if there is nothing in the customers cart, redirect them to the shopping cart pageif ($_SESSION['cart']->count_contents() < 1)    xtc_redirect(xtc_href_link(FILENAME_SHOPPING_CART));// if no shipping method has been selected, redirect the customer to the shipping method selection pageif (!isset($_SESSION['shipping']))    xtc_redirect(xtc_href_link(FILENAME_CHECKOUT_SHIPPING, '', 'SSL'));// avoid hack attempts during the checkout procedure by checking the internal cartIDif (isset($_SESSION['cart']->cartID) && isset($_SESSION['cartID'])) {    if ($_SESSION['cart']->cartID != $_SESSION['cartID'])        xtc_redirect(xtc_href_link(FILENAME_CHECKOUT_SHIPPING, '', 'SSL'));}if (isset($_SESSION['credit_covers']))    unset($_SESSION['credit_covers']); //ICW ADDED FOR CREDIT CLASS SYSTEM// Stock Checkif ((STOCK_CHECK == 'true') && (STOCK_ALLOW_CHECKOUT != 'true')) {    $products = $_SESSION['cart']->get_products();    $any_out_of_stock = 0;    for ($i = 0, $n = sizeof($products); $i < $n; $i++) {        if (xtc_check_stock($products[$i]['id'], $products[$i]['quantity']))            $any_out_of_stock = 1;    }    if ($any_out_of_stock == 1)        xtc_redirect(xtc_href_link(FILENAME_SHOPPING_CART));}// if no billing destination address was selected, use the customers own address as defaultif (!isset($_SESSION['billto'])) {    $_SESSION['billto'] = $_SESSION['customer_default_address_id'];} else {    // verify the selected billing address    $check_address_query = xtc_db_query("select count(*) as total from " . TABLE_ADDRESS_BOOK . " where customers_id = '" . (int) $_SESSION['customer_id'] . "' and address_book_id = '" . (int) $_SESSION['billto'] . "'");    $check_address = xtc_db_fetch_array($check_address_query);    if ($check_address['total'] != '1') {        $_SESSION['billto'] = $_SESSION['customer_default_address_id'];        if (isset($_SESSION['payment']))            unset($_SESSION['payment']);    }}if (!isset($_SESSION['sendto']) || $_SESSION['sendto'] == "")    $_SESSION['sendto'] = $_SESSION['billto'];require (DIR_WS_CLASSES . 'order.php');$breadcrumb->add(NAVBAR_TITLE_1_CHECKOUT_PAYMENT, xtc_href_link(FILENAME_CHECKOUT_SHIPPING, '', 'SSL'));$breadcrumb->add(NAVBAR_TITLE_2_CHECKOUT_PAYMENT, xtc_href_link(FILENAME_CHECKOUT_PAYMENT, '', 'SSL'));//XTC STANDARD END//Checks if conditions were accepted and all needed ratepay data is send and assigning some Template variablesif (isset($_POST['conditions'])) {    if (isset($_POST['pirprate'])) {        $checking = true;        if (isset($_SESSION['pi_ratepay_rate_total_amount']) == false || $_SESSION['pi_ratepay_rate_total_amount'] == "") {            $checking = false;        } else if (isset($_SESSION['pi_ratepay_rate_amount']) == false || $_SESSION['pi_ratepay_rate_amount'] == "") {            $checking = false;        } else if (isset($_SESSION['pi_ratepay_rate_interest_amount']) == false || $_SESSION['pi_ratepay_rate_interest_amount'] == "") {            $checking = false;        } else if (isset($_SESSION['pi_ratepay_rate_service_charge']) == false || $_SESSION['pi_ratepay_rate_service_charge'] == "") {            $checking = false;        } else if (isset($_SESSION['pi_ratepay_rate_annual_percentage_rate']) == false || $_SESSION['pi_ratepay_rate_annual_percentage_rate'] == "") {            $checking = false;        } else if (isset($_SESSION['pi_ratepay_rate_monthly_debit_interest']) == false || $_SESSION['pi_ratepay_rate_monthly_debit_interest'] == "") {            $checking = false;        } else if (isset($_SESSION['pi_ratepay_rate_number_of_rates']) == false || $_SESSION['pi_ratepay_rate_number_of_rates'] == "") {            $checking = false;        } else if (isset($_SESSION['pi_ratepay_rate_rate']) == false || $_SESSION['pi_ratepay_rate_rate'] == "") {            $checking = false;        } else if (isset($_SESSION['pi_ratepay_rate_last_rate']) == false || $_SESSION['pi_ratepay_rate_last_rate'] == "") {            $checking = false;        }        if ($checking) {            $_SESSION['pi_ratepay_rate_conditions'] = true;            xtc_redirect(xtc_href_link("checkout_confirmation.php", '', 'SSL'));        }    }} else {    xtc_redirect(xtc_href_link("pi_ratepay_rate_checkout_terms.php", '', 'SSL'));}require (DIR_WS_INCLUDES . 'header.php');$smarty->caching = 0;$main_content = $smarty->fetch(CURRENT_TEMPLATE . '/module/pi_ratepay_rate_checkout_details.html');$smarty->assign('language', $_SESSION['language']);$smarty->assign('main_content', $main_content);$smarty->caching = 0;if (!defined(RM))    $smarty->load_filter('output', 'note');$smarty->display(CURRENT_TEMPLATE . '/index.html');include ('includes/application_bottom.php');?>